---
import ProjectLayout from "@/layouts/ProjectLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async () => {
  const projects = await getCollection("projects");
  return projects.map((project, index) => {
    const prevProject = index > 0 ? projects[index - 1] : null;
    const nextProject = index < projects.length - 1 ? projects[index + 1] : null;

    return {
      params: { slug: project.slug },
      props: {
        project,
        prevProject: prevProject
          ? { slug: prevProject.slug, title: prevProject.data.title }
          : undefined,
        nextProject: nextProject
          ? { slug: nextProject.slug, title: nextProject.data.title }
          : undefined,
      },
    };
  });
}) satisfies GetStaticPaths;

const { project, prevProject, nextProject } = Astro.props;
const { Content } = await project.render();
const { data } = project;
---

<ProjectLayout
  title={data.title}
  description={data.summary}
  date={data.date}
  ogImage={data.cover}
  slug={project.slug}
  prevProject={prevProject}
  nextProject={nextProject}
>
  <header class="space-y-4 mb-8">
    <div class="flex items-start justify-between gap-4">
      <h1 class="text-3xl md:text-4xl font-semibold text-black">{data.title}</h1>
      {data.year && <span class="text-black/50 shrink-0">{data.year}</span>}
    </div>

    <p class="text-black/70 text-lg leading-relaxed">{data.summary}</p>

    <div class="flex flex-wrap gap-6 pt-2 text-sm">
      {
        data.client && (
          <div>
            <span class="text-black/50">Kunde:</span>{" "}
            <span class="text-black/80">{data.client}</span>
          </div>
        )
      }
      {
        data.services && data.services.length > 0 && (
          <div>
            <span class="text-black/50">Leistungen:</span>{" "}
            <span class="text-black/80">{data.services.join(", ")}</span>
          </div>
        )
      }
    </div>

    {
      data.tech && data.tech.length > 0 && (
        <div class="pt-2">
          <span class="text-xs text-black/50 block mb-2">Technologien:</span>
          <ul class="flex flex-wrap gap-2 list-none m-0 p-0">
            {data.tech.map((t) => (
              <li class="text-xs px-2.5 py-1 rounded-lg bg-black/5 border border-black/10 text-black/80">
                {t}
              </li>
            ))}
          </ul>
        </div>
      )
    }

    {
      data.links?.demo && (
        <div class="pt-2">
          <a
            class="inline-flex items-center gap-1 text-sm underline hover:text-black/80 transition-colors focus-ring text-black/70"
            href={data.links.demo}
            target="_blank"
            rel="noopener noreferrer"
          >
            Live-Demo ansehen
            <svg
              class="w-4 h-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
              />
            </svg>
          </a>
        </div>
      )
    }
  </header>

  <article class="prose prose-lg max-w-none">
    <Content />
  </article>
</ProjectLayout>
